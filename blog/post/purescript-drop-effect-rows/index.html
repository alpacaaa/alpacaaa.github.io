<!DOCTYPE html>
<html lang="en-us">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    


    
        <meta name="twitter:card" content="summary"/>
    



<meta name="twitter:title" content="Beginning Purescript: Dropping effect rows"/>
<meta name="twitter:description" content="Effect rows in Eff (and Aff) are pretty annoying and they&rsquo;re something I wanted to get around since I started learning Purescript. On the one hand, they look pretty useful because you can tell immediately what kind of effects are involved in a specific function, but you quickly realize that unifying effects is extremely cumbersome.
Consider this function
randomNumber :: forall eff. Int -&gt; Int -&gt; Eff { random :: RANDOM | eff } Int  The effect row would be { random :: RANDOM | eff }."/>



  	<meta property="og:title" content=" Beginning Purescript: Dropping effect rows &middot;  alpacaaa" />
  	<meta property="og:site_name" content="alpacaaa" />
  	<meta property="og:url" content="https://alpacaaa.net/blog/post/purescript-drop-effect-rows/" />

    
  	<meta property="og:type" content="article" />

    <meta property="og:article:published_time" content="2018-01-06T11:00:39&#43;01:00" />

    
    

    <title>
       Beginning Purescript: Dropping effect rows &middot;  alpacaaa
    </title>

    <meta name="description" content="Marco Sampellegrini" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://alpacaaa.net/blog/images/favicon.ico">
	  <link rel="apple-touch-icon" href="https://alpacaaa.net/blog/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="https://alpacaaa.net/blog/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="https://alpacaaa.net/blog/css/nav.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400|Inconsolata" />


    
      
          <link href="https://alpacaaa.net/blog/index.xml" rel="alternate" type="application/rss+xml" title="alpacaaa" />
      
      
    
    <meta name="generator" content="Hugo 0.17" />

    <link rel="canonical" href="https://alpacaaa.net/blog/post/purescript-drop-effect-rows/" />

    

    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        

        
    </ul>

    
    <a class="subscribe-button icon-feed" href="https://alpacaaa.net/blog/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">




<header class="main-header post-head no-cover">
  <nav class="main-nav clearfix">


  
      <a class="blog-logo" href="https://alpacaaa.net/blog/"><img src="https://alpacaaa.net/blog/images/logo.png" alt="Home" /></a>
      
  
  
      <a class="menu-button icon-feed" href="https://alpacaaa.net/blog/index.xml">&nbsp;&nbsp;Subscribe</a>
  
  </nav>
</header>



<main class="content single-post" role="main">




  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">Beginning Purescript: Dropping effect rows</h1>
        <small></small>

        <section class="post-meta">
        
          <time class="post-date" datetime="2018-01-06T11:00:39&#43;01:00">
            Jan 6, 2018
          </time>
        
         
        </section>
    </header>

    <section class="post-content">
      

<p>Effect rows in <code>Eff</code> (and <code>Aff</code>) are pretty annoying and they&rsquo;re something I wanted to get around since I started learning Purescript. On the one hand, they look pretty useful because you can tell immediately what kind of effects are involved in a specific function, but you quickly realize that unifying effects is extremely cumbersome.</p>

<p>Consider this function</p>
<div class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span></span><span class="nf">randomNumber</span> <span class="ow">::</span> <span class="n">forall</span> <span class="n">eff</span><span class="o">.</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Eff</span> <span class="p">{</span> <span class="n">random</span> <span class="ow">::</span> <span class="kt">RANDOM</span> <span class="o">|</span> <span class="n">eff</span> <span class="p">}</span> <span class="kt">Int</span>
</code></pre></div>

<p>The effect row would be <code>{ random :: RANDOM | eff }</code>.</p>

<p>I assume you&rsquo;re already familiar with how records work in Purescript, if not <a href="https://github.com/purescript/documentation/blob/master/language/Records.md">read this document</a>. This type signature is saying that it will make use of the <code>RANDOM</code> effect and that it will work in any effectful program that is <strong>at least</strong> capable of handling it.</p>

<p>Now, consider this program:</p>
<div class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span></span><span class="nf">program</span> <span class="ow">::</span> <span class="kt">Eff</span> <span class="p">{</span> <span class="n">random</span> <span class="ow">::</span> <span class="kt">RANDOM</span><span class="p">,</span> <span class="n">console</span> <span class="ow">::</span> <span class="kt">CONSOLE</span> <span class="p">}</span> <span class="kt">Unit</span>
<span class="nf">program</span> <span class="ow">=</span> <span class="kr">do</span>
	<span class="n">n</span> <span class="ow">&lt;-</span> <span class="n">randomNumber</span> <span class="mi">0</span> <span class="mi">10</span>
	<span class="kt">Console</span><span class="o">.</span><span class="n">log</span> <span class="o">$</span> <span class="s">&quot;Random number: &quot;</span> <span class="o">&lt;&gt;</span> <span class="p">(</span><span class="n">show</span> <span class="n">n</span><span class="p">)</span>
</code></pre></div>

<p>This compiles just fine because all the effects involved in <code>program</code> are correctly tracked in its effect row. An important thing to note is that <code>program</code> will <strong>only</strong> run in a larger program if it provides exactly the <code>RANDOM</code> and <code>CONSOLE</code> effects. That&rsquo;s because we&rsquo;re not leaving the row open as we previously did with <code>randomNumber</code>.</p>
<div class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span></span><span class="nf">main</span> <span class="ow">::</span> <span class="kt">Eff</span> <span class="p">{</span> <span class="n">random</span> <span class="ow">::</span> <span class="kt">RANDOM</span><span class="p">,</span> <span class="n">console</span> <span class="ow">::</span> <span class="kt">CONSOLE</span><span class="p">,</span> <span class="n">http</span> <span class="ow">::</span> <span class="kt">HTTP</span> <span class="p">}</span> <span class="kt">Unit</span>
<span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span>
	<span class="kt">Console</span><span class="o">.</span><span class="n">log</span> <span class="s">&quot;Let&#39;s generate a random number&quot;</span>
	<span class="n">program</span>
</code></pre></div>

<p>This <strong>will not</strong> compile. The effect rows of <code>main</code> and <code>program</code> do not match and thus we&rsquo;re not allowed to call <code>program</code> from <code>main</code> (let alone the opposite).</p>

<p>The effect rows we used so far aren&rsquo;t any more or less interesting than what you would use with other records, so the same rules apply.</p>
<div class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span></span><span class="kr">type</span> <span class="kt">User</span> <span class="ow">=</span>
	<span class="p">{</span> <span class="n">name</span> <span class="ow">::</span> <span class="kt">String</span><span class="p">,</span> <span class="n">age</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="p">}</span>

<span class="kr">type</span> <span class="kt">Person</span> <span class="ow">=</span>
	<span class="p">{</span> <span class="n">name</span> <span class="ow">::</span> <span class="kt">String</span><span class="p">,</span> <span class="n">age</span> <span class="ow">::</span> <span class="kt">Int</span><span class="p">,</span> <span class="n">country</span> <span class="ow">::</span> <span class="kt">Country</span> <span class="p">}</span>

<span class="nf">greet</span> <span class="ow">::</span> <span class="n">forall</span> <span class="n">r</span><span class="o">.</span> <span class="p">{</span> <span class="n">name</span> <span class="ow">::</span> <span class="kt">String</span> <span class="o">|</span> <span class="n">r</span> <span class="p">}</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
<span class="nf">greet</span> <span class="p">{</span> <span class="n">name</span> <span class="p">}</span> <span class="ow">=</span> <span class="s">&quot;Hello &quot;</span> <span class="o">&lt;&gt;</span> <span class="n">name</span> <span class="o">&lt;&gt;</span> <span class="s">&quot;!&quot;</span>
</code></pre></div>

<p>The <code>greet</code> function works with any record that has at least a <code>name</code> property of type <code>String</code>. Again, that&rsquo;s because we&rsquo;re leaving the row open, so it works with values of type <code>User</code> and <code>Person</code> seamlessly.</p>

<h4 id="is-it-worth-it">Is it worth it?</h4>

<p>You now have a better understanding of how effect rows work and what problem they&rsquo;re trying to solve. We wouldn&rsquo;t want to have a function making an http request in a context where we&rsquo;re only expecting text to be written to the console.</p>

<p>All things considered, this isn&rsquo;t that useful in practice.</p>

<p>The good news is that Purescript 0.12 will drop the effect row from <code>Eff</code> (as of the time of writing, it&rsquo;s still not clear how). We&rsquo;ll basically get the <code>IO a</code> type from Haskell, which is exactly like <code>Eff eff a</code> minus the effect row.</p>

<p>Until then, the best way I found to workaround effect rows is to drop them.</p>

<h4 id="just-drop-the-effect-row">Just drop the effect row</h4>

<p>When I first approached Purescript, I got bitten pretty often by errors related to effect rows not unifying. I was so annoyed that I removed type signatures all together from functions in <code>Eff</code> and let the compiler figure out everything by itself.</p>

<p>However, that was far from ideal.</p>

<p>A much better solution is to keep the type signatures and use the wildcard pattern <code>_</code> which gives us a pretty close approximation of <code>IO</code>.</p>

<p>Essentially, I would write the <code>randomNumber</code> function from before with this type signature:</p>
<div class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span></span><span class="nf">randomNumber</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Eff</span> <span class="kr">_</span> <span class="kt">Int</span>
</code></pre></div>

<p>This is much more smooth and concise â€“ much better.</p>

<p>If we rewrite <code>program</code> and <code>main</code> to follow the same pattern, the code we previously wrote will now compile because any effect row will unify with all functions!</p>
<div class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span></span><span class="nf">program</span> <span class="ow">::</span> <span class="kt">Eff</span> <span class="kr">_</span> <span class="kt">Unit</span>
<span class="nf">program</span> <span class="ow">=</span> <span class="kr">do</span>
	<span class="n">n</span> <span class="ow">&lt;-</span> <span class="n">randomNumber</span> <span class="mi">0</span> <span class="mi">10</span>
	<span class="kt">Console</span><span class="o">.</span><span class="n">log</span> <span class="o">$</span> <span class="s">&quot;Random number: &quot;</span> <span class="o">&lt;&gt;</span> <span class="p">(</span><span class="n">show</span> <span class="n">n</span><span class="p">)</span>

<span class="nf">main</span> <span class="ow">::</span> <span class="kt">Eff</span> <span class="kr">_</span> <span class="kt">Unit</span>
<span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span>
	<span class="kt">Console</span><span class="o">.</span><span class="n">log</span> <span class="s">&quot;Let&#39;s generate a random number&quot;</span>
	<span class="n">program</span> <span class="c1">-- this will now compile</span>
</code></pre></div>

<p>One thing that is still a bit annoying about this is when you&rsquo;re using type synonyms.</p>
<div class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span></span><span class="kr">type</span> <span class="kt">RandomNumberEff</span> <span class="n">eff</span> <span class="ow">=</span>
	<span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Eff</span> <span class="n">eff</span> <span class="kt">Int</span>
</code></pre></div>

<p>We can&rsquo;t drop the effect row here, because we can&rsquo;t use wildcard patterns in type definitions. But this is easily fixed when defining a function with the <code>RandomNumberEff</code> type.</p>
<div class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span></span><span class="nf">randomNumber</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">RandomNumberEff</span> <span class="kr">_</span>
</code></pre></div>

<h4 id="conclusion">Conclusion</h4>

<p>Purescript 0.12 will introduce <code>IO a</code> so most of this post will not apply anymore. But if you want to get started in Purescript right now and found effects tracking to be uncomfortable and annoying, you now have a little trick up your sleeve to workaround the current effect system.</p>

<p>You can <a href="https://twitter.com/_alpacaaa">reach me on Twitter</a>.</p>

<p>Thanks to <a href="https://twitter.com/giuliocanti">@giuliocanti</a> for reviewing this post.</p>

    </section>


  <footer class="post-footer">


    
    <figure class="author-image">
        <a class="img" href="https://alpacaaa.net/blog/" style="background-image: url(https://alpacaaa.net/blog/images/avatar.png)"><span class="hidden">Marco Sampellegrini's Picture</span></a>
    </figure>
    

    





<section class="author">
  <h4><a href="https://alpacaaa.net/blog/">Marco Sampellegrini</a></h4>
  
  <p>Exploring functional programming ideas.</p>
  
  <div class="author-meta">
    <span class="author-location icon-location">Milan, Italy</span>
    <span class="author-link icon-link"><a href="https://alpacaaa.net">https://alpacaaa.net</a></span>
  </div>
</section>



    


    




  </footer>
</article>

</main>
    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">alpacaaa</a> </section>
        
    </footer>
    </div>
    <script type="text/javascript" src="https://alpacaaa.net/blog/js/jquery.js"></script>
    <script type="text/javascript" src="https://alpacaaa.net/blog/js/index.js"></script>
    
</body>
</html>

